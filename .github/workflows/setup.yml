name: Main Deployment Workflow

on:
  push:
    branches:
      - main  # Trigger on push to the main branch
  workflow_dispatch:  # Allow manual triggering
    inputs:
      deploy_setup:
        description: "Run Setup"
        required: false
        default: "false"
      deploy_spark:
        description: "Deploy Spark"
        required: false
        default: "false"
      deploy_airflow:
        description: "Deploy Airflow"
        required: false
        default: "false"
      deploy_kafka:
        description: "Deploy Kafka"
        required: false
        default: "false"
      deploy_superset:
        description: "Deploy Superset"
        required: false
        default: "false"
      deploy_sts_trino:
        description: "Deploy ThriftServer and Trino"
        required: false
        default: "false"

jobs:
  setup:
    name: Setup Environment
    if: ${{ github.event.inputs.deploy_setup == 'true' }}  # Conditional execution
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Trigger setup workflow
        uses: ./.github/workflows/setup.yml  # Referencing the setup.yml workflow

  deploy_spark:
    name: Deploy Spark
    needs: setup
    if: ${{ github.event.inputs.deploy_spark == 'true' }}  # Conditional execution
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Trigger deploy_spark workflow
        uses: ./.github/workflows/deploy_spark.yml

  deploy_airflow:
    name: Deploy Airflow
    needs: setup
    if: ${{ github.event.inputs.deploy_airflow == 'true' }}  # Conditional execution
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Trigger deploy_airflow workflow
        uses: ./.github/workflows/deploy_airflow.yml

  deploy_kafka:
    name: Deploy Kafka
    needs: setup
    if: ${{ github.event.inputs.deploy_kafka == 'true' }}  # Conditional execution
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Trigger deploy_kafka workflow
        uses: ./.github/workflows/deploy_kafka.yml

  deploy_superset:
    name: Deploy Superset
    needs: setup
    if: ${{ github.event.inputs.deploy_superset == 'true' }}  # Conditional execution
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Trigger deploy_superset workflow
        uses: ./.github/workflows/deploy_superset.yml

  deploy_sts_trino:
    name: Deploy ThriftServer and Trino
    needs: setup
    if: ${{ github.event.inputs.deploy_sts_trino == 'true' }}  # Conditional execution
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Trigger deploy_sts_trino workflow
        uses: ./.github/workflows/deploy_sts_trino.yml
